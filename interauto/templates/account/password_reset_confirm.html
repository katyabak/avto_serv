{% extends "base.html" %}
{% block content %}
{% load form_tags %}
<div class="container py-5" style="max-width: 400px;">
  <h2 class="fw-bold mb-4 text-center">Новый пароль</h2>
  <form method="post">
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="alert alert-danger">
        {% for error in form.non_field_errors %}
          {{ error }}
        {% endfor %}
      </div>
    {% endif %}

    <div class="mb-3 position-relative">
      {{ form.new_password1.label_tag }}
      <input type="password" name="{{ form.new_password1.html_name }}" id="new-password1" class="form-control" />
      <button type="button" id="toggle-password1" class="btn btn-sm btn-outline-secondary mt-1">Показать пароль</button>
      {% for error in form.new_password1.errors %}
        <div class="text-danger">
          {% with e=error|stringformat:"s" %}
            {% if "too short" in e %}
              Пароль слишком короткий. Минимум 8 символов.
            {% elif "didn’t match" in e %}
              Пароли не совпадают. Введите заново.
            {% elif "entirely numeric" in e %}
              Пароль не может состоять только из цифр.
            {% else %}
              {{ error }}
            {% endif %}
          {% endwith %}
        </div>
      {% endfor %}
    </div>

    <div class="mb-3 position-relative">
      {{ form.new_password2.label_tag }}
      <input type="password" name="{{ form.new_password2.html_name }}" id="new-password2" class="form-control" />
      <button type="button" id="toggle-password2" class="btn btn-sm btn-outline-secondary mt-1">Показать пароль</button>
      {% for error in form.new_password2.errors %}
        <div class="text-danger">
          {% with e=error|stringformat:"s" %}
            {% if "didn’t match" in e %}
              Пароли не совпадают. Введите заново.
            {% else %}
              {{ error }}
            {% endif %}
          {% endwith %}
        </div>
      {% endfor %}
    </div>

    <button type="submit" class="btn w-100" style="background-color: #334B5B; color: #ffffff;">Сменить пароль</button>
  </form>
</div>

<script>
  const toggle1 = document.getElementById('toggle-password1');
  const pass1 = document.getElementById('new-password1');
  toggle1.addEventListener('click', () => {
    if (pass1.type === 'password') {
      pass1.type = 'text';
      toggle1.textContent = 'Скрыть пароль';
    } else {
      pass1.type = 'password';
      toggle1.textContent = 'Показать пароль';
    }
  });

  const toggle2 = document.getElementById('toggle-password2');
  const pass2 = document.getElementById('new-password2');
  toggle2.addEventListener('click', () => {
    if (pass2.type === 'password') {
      pass2.type = 'text';
      toggle2.textContent = 'Скрыть пароль';
    } else {
      pass2.type = 'password';
      toggle2.textContent = 'Показать пароль';
    }
  });
</script>
{% endblock %}
